{{- if .Values.trafficGroup.enabled }}
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: ciliumtrafficgroups.cilium.io
  labels:
    app.kubernetes.io/part-of: cilium
spec:
  group: cilium.io
  names:
    categories:
      - cilium
    kind: CiliumTrafficGroup
    listKind: CiliumTrafficGroupList
    plural: ciliumtrafficgroups
    shortNames:
      - ctg
    singular: ciliumtrafficgroup
  scope: Cluster
  versions:
    - name: v2alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          description: |
            CiliumTrafficGroup 定义了基于 CIDR 的流量分组，用于按目标地址进行流量分类和限速。
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              type: object
              required:
                - id
                - cidrs
              properties:
                id:
                  type: integer
                  minimum: 1
                  maximum: 65535
                  description: |
                    流量组的唯一标识符，用于 BPF Map 中的快速查找。
                    必须是 1-65535 之间的正整数，0 保留给未匹配任何规则的默认流量。
                cidrs:
                  type: array
                  minItems: 1
                  items:
                    type: string
                    pattern: '^([0-9]{1,3}\.){3}[0-9]{1,3}/[0-9]{1,2}$|^([0-9a-fA-F:]+)/[0-9]{1,3}$'
                  description: |
                    属于此流量组的 CIDR 列表。使用最长前缀匹配 (LPM) 规则。
                    使用 0.0.0.0/0 可以作为兜底规则匹配所有未被其他规则匹配的流量。
      additionalPrinterColumns:
        - name: ID
          type: integer
          jsonPath: .spec.id
        - name: CIDRs
          type: string
          jsonPath: .spec.cidrs
{{- end }}
